<orb-dialog
  [(visible)]="visible"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="agenda-config-modal"
  (onHide)="onHide()"
>
  <div slot="header">
    <h3>丘뙖잺 Configuraci칩n de Agenda</h3>
  </div>
  
  <div slot="content">
    <form [formGroup]="configForm" class="config-form">
      
      <!-- Card: Horario de trabajo -->
      <div class="config-card">
        <div class="card-header">
          <h4><i class="fas fa-clock"></i> Horario de Trabajo</h4>
        </div>
        <div class="card-content">
          <div class="time-inputs">
            <div class="input-group">
              <p-floatLabel>
                <input 
                  pInputText 
                  id="startTime"
                  type="time" 
                  formControlName="startTime"
                  class="w-full"
                />
                <label for="startTime">Hora de inicio</label>
              </p-floatLabel>
            </div>
            
            <div class="input-group">
              <p-floatLabel>
                <input 
                  pInputText 
                  id="endTime"
                  type="time" 
                  formControlName="endTime"
                  class="w-full"
                />
                <label for="endTime">Hora de fin</label>
              </p-floatLabel>
            </div>
          </div>
        </div>
      </div>

      <!-- Card: Configuraci칩n de turnos -->
      <div class="config-card">
        <div class="card-header">
          <h4><i class="fas fa-stopwatch"></i> Configuraci칩n de Turnos</h4>
        </div>
        <div class="card-content">
          <div class="input-group">
            <p-floatLabel>
              <p-inputNumber 
                id="slotDuration"
                formControlName="slotDuration"
                [min]="15"
                [max]="120"
                suffix=" min"
                styleClass="w-full"
              />
              <label for="slotDuration">Duraci칩n de cada turno</label>
            </p-floatLabel>
            <small class="help-text">Entre 15 y 120 minutos</small>
          </div>
        </div>
      </div>

      <!-- Card: D칤as laborales -->
      <div class="config-card">
        <div class="card-header">
          <h4><i class="fas fa-calendar-week"></i> D칤as Laborales</h4>
        </div>
        <div class="card-content">
          <div class="working-days">
            <div 
              *ngFor="let day of weekDays; let i = index" 
              class="day-checkbox"
            >
              <input
                type="checkbox"
                [id]="'day-' + i"
                [formControl]="workingDaysControls[i]"
                class="day-input"
              />
              <label [for]="'day-' + i" class="day-label">
                {{ day.label }}
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Card: Configuraciones adicionales -->
      <div class="config-card">
        <div class="card-header">
          <h4><i class="fas fa-cogs"></i> Configuraciones Adicionales</h4>
        </div>
        <div class="card-content">
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="overbooking"
                formControlName="overbookingAllowed"
                class="config-checkbox"
              />
              <label for="overbooking" class="checkbox-label">
                Permitir sobrebooking
              </label>
              <small class="help-text">Permitir m치s citas de las que el horario normalmente permite</small>
            </div>
            
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="blockedDays"
                formControlName="allowBookingOnBlockedDays"
                class="config-checkbox"
              />
              <label for="blockedDays" class="checkbox-label">
                Permitir reservas en d칤as bloqueados
              </label>
              <small class="help-text">Los clientes pueden reservar en d칤as marcados como feriados</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Card: D칤as Festivos / Vacaciones -->
      <div class="config-card holidays-card">
        <div class="card-header">
          <h4><i class="fas fa-umbrella-beach"></i> D칤as Festivos y Vacaciones</h4>
        </div>
        <div class="card-content">
          <div class="holidays-management">
            <div class="holidays-list">
              <div 
                *ngFor="let holiday of (agendaStore.agendaHolydays$ | async) || []; trackBy: trackByHolidayId"
                class="holiday-item"
              >
                <div class="holiday-info">
                  <span class="holiday-date">游늰 {{ formatDisplayDate(holiday.date) }}</span>
                  <span class="holiday-reason">{{ holiday.description || 'Sin descripci칩n' }}</span>
                </div>
                <orb-button
                  icon="pi pi-trash"
                  severity="danger"
                  size="small"
                  pTooltip="Eliminar d칤a festivo"
                  (click)="onDeleteHoliday(holiday)"
                />
              </div>
              
              <div *ngIf="!(agendaStore.agendaHolydays$ | async)?.length" class="no-holidays">
                <p>No hay d칤as festivos configurados.</p>
              </div>
            </div>

            <div class="add-holiday">
              <orb-button
                label="Agregar D칤a Festivo"
                icon="pi pi-plus"
                severity="info"
                size="small"
                (click)="showAddHolidayForm = !showAddHolidayForm"
              />
            </div>

            <!-- Formulario para agregar festivo -->
            <div *ngIf="showAddHolidayForm" class="add-holiday-form">
              <form [formGroup]="holidayForm" class="holiday-form-inline">
                <div class="input-group">
                  <p-floatLabel>
                    <p-calendar 
                      id="holidayDate"
                      formControlName="date"
                      dateFormat="dd/mm/yy"
                      styleClass="w-full"
                    />
                    <label for="holidayDate">Fecha</label>
                  </p-floatLabel>
                </div>
                
                <div class="input-group">
                  <p-floatLabel>
                    <input 
                      pInputText 
                      id="holidayReason"
                      formControlName="reason"
                      class="w-full"
                    />
                    <label for="holidayReason">Descripci칩n (opcional)</label>
                  </p-floatLabel>
                </div>

                <div class="form-actions">
                  <orb-button
                    label="Cancelar"
                    severity="secondary"
                    size="small"
                    (click)="onCancelAddHoliday()"
                  />
                  <orb-button
                    label="Agregar"
                    severity="success"
                    icon="pi pi-plus"
                    size="small"
                    (click)="onAddHoliday()"
                    [loading]="!!(agendaStore.holidaysLoading$ | async)"
                    [disabled]="holidayForm.invalid"
                  />
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

    </form>
  </div>
  
  <div slot="footer">
    <div class="modal-actions">
      <orb-button
        label="Cancelar"
        severity="secondary"
        (click)="onCancel()"
        [disabled]="!!(agendaStore.configLoading$ | async)"
      />
      <orb-button
        label="Guardar Configuraci칩n"
        severity="success"
        icon="pi pi-save"
        (click)="onSave()"
        [loading]="!!(agendaStore.configLoading$ | async)"
        [disabled]="configForm.invalid"
      />
    </div>
  </div>
</orb-dialog>

<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>