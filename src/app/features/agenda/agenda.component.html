<!-- Card de filtros horizontal compacto -->
<orb-card class="compact-card">
  <div orbHeader>
    <h3 class="compact-title">Agenda - Filtros</h3>
  </div>
  
  <div orbBody>
    <div class="compact-filters-container">
      <!-- Fila única con todos los filtros -->
      <div class="filters-row">
        <!-- Filtro de Profesionales -->
        <div class="filter-item">
          <label class="compact-label">Profesionales</label>
          <orb-multiselect
            placeholder="Todos"
            [options]="(usersStore.users$ | async) || []"
            optionLabel="fullName"
            [ngModel]="selectedUsers"
            (ngModelChange)="onUsersChange($event)"
            styleClass="compact-multiselect"
            display="chip"
            [maxSelectedLabels]="1"
            selectedItemsLabel="{0} sel."
          ></orb-multiselect>
        </div>

        <!-- Filtro de Estados -->
        <div class="filter-item">
          <label class="compact-label">Estados</label>
          <orb-multiselect
            placeholder="Todos"
            [options]="statusOptions"
            optionLabel="label"
            optionValue="value"
            [ngModel]="selectedStatuses"
            (ngModelChange)="onStatusesChange($event)"
            styleClass="compact-multiselect"
            display="chip"
            [maxSelectedLabels]="1"
            selectedItemsLabel="{0} sel."
          ></orb-multiselect>
        </div>

        <!-- DateRangePicker -->
        <div class="filter-item filter-date">
          <label class="compact-label">Rango de fechas</label>
          <orb-date-range-picker
            [config]="dateRangePickerConfig"
            [ngModel]="selectedDateRange"
            (dateRangeChange)="onDateRangeChange($event)"
          ></orb-date-range-picker>
        </div>

        <!-- Filtro individual de fecha y hora (para crear cita) -->
        <div class="filter-item">
          <label class="compact-label">Fecha específica</label>
          <orb-datepicker
            mode="datetime"
            placeholder="dd/mm/yyyy hh:mm"
            [ngModel]="selectedDateFrom"
            (ngModelChange)="onDateFromChange($event)"
            styleClass="compact-datepicker"
          ></orb-datepicker>
        </div>

        <!-- Botones de acción -->
        <div class="filter-actions">
          <orb-button
            icon="pi pi-search"
            title="Buscar"
            (click)="performSearch()"
            size="small"
            styleClass="compact-btn"
          ></orb-button>
          <orb-button
            icon="pi pi-calendar"
            title="Hoy"
            severity="secondary"
            (click)="resetToToday()"
            size="small"
            styleClass="compact-btn"
          ></orb-button>
          <orb-button
            icon="pi pi-plus"
            title="Nuevo Turno"
            severity="success"
            (click)="openNewAppointmentDialog()"
            size="small"
            styleClass="compact-btn"
          ></orb-button>
          <orb-button
            icon="pi pi-info-circle"
            title="Información"
            severity="info"
            (click)="op.toggle($event)"
            size="small"
            styleClass="compact-btn"
          ></orb-button>
          <p-overlayPanel #op>
            <app-status-legend [statusColors]="statusColors"></app-status-legend>
          </p-overlayPanel>
        </div>
      </div>
    </div>
  </div>
</orb-card>

<!-- Card del calendario con estados -->
<orb-card style="margin-top: 1rem;">
  <div orbBody>
    <!-- Estados del resumen en la parte superior -->
    <div class="calendar-summary" *ngIf="(agendaStore.summary$ | async) as summary">
      <div class="summary-tags">
        <div *ngFor="let item of summary | keyvalue">
          <ng-container *ngIf="item.key !== 'total' && item.key !== 'byDate'">
            <p-tag [style]="{ backgroundColor: getColor(getKeyAsString(item.key)) }" [value]="getTranslatedStatus(getKeyAsString(item.key)) + ': ' + item.value"></p-tag>
          </ng-container>
        </div>
      </div>
    </div>
    
    <!-- Modern Calendar (Angular Calendar - Free) -->
    <orb-modern-calendar
      [events]="(agendaStore.calendarEvents$ | async) || []"
      [slotDuration]="(agendaStore.agendaConfig$ | async)?.slotDurationMinutes || 30"
      (datesSetRange)="handleDatesSet($event)"
      (eventClick)="handleEventClick($event)"
      (dateSelect)="handleDateSelect($event)"
      (eventDrop)="handleEventDrop($event)"
    ></orb-modern-calendar>
  </div>
</orb-card>

<orb-dialog [(visible)]="displayAgendaForm" (onHide)="onFormClose()" [header]="selectedAppointment ? 'Editar Turno' : 'Nuevo Turno'">
  <app-agenda-form
    *ngIf="displayAgendaForm"
    [appointment]="selectedAppointment"
    [initialDate]="dialogInitialDate"
    (close)="onFormClose()"
    (delete)="handleDelete($event)"
  ></app-agenda-form>
</orb-dialog>

