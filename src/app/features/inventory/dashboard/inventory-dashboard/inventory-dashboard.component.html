<!-- Header -->
<orb-main-header
  title="Dashboard de Inventario"
  icon="fa fa-warehouse"
  subtitle="Gesti칩n y control integral de productos y movimientos de stock">
</orb-main-header>

<!-- Metrics Grid usando sistema global -->
<div class="metrics-grid">
  <!-- Total Productos -->
  <div class="metric-card info">
    <div class="metric-content">
      <div class="metric-icon">
        <i class="fa fa-box"></i>
      </div>
      <div class="metric-details">
        <h3>{{ totalProducts() }}</h3>
        <span>Total Productos</span>
      </div>
    </div>
  </div>

  <!-- Stock Bajo -->
  <div class="metric-card warning">
    <div class="metric-content">
      <div class="metric-icon">
        <i class="fa fa-exclamation-triangle"></i>
      </div>
      <div class="metric-details">
        <h3>{{ lowStockProducts() }}</h3>
        <span>Stock Bajo</span>
      </div>
    </div>
  </div>

  <!-- Valor Total -->
  <div class="metric-card success">
    <div class="metric-content">
      <div class="metric-icon">
        <i class="fa fa-euro-sign"></i>
      </div>
      <div class="metric-details">
        <h3>{{ totalValue() | currency : 'EUR' : 'symbol' : '1.0-0' }}</h3>
        <span>Valor Total</span>
      </div>
    </div>
  </div>

  <!-- Movimientos Hoy -->
  <div class="metric-card purple">
    <div class="metric-content">
      <div class="metric-icon">
        <i class="fa fa-exchange-alt"></i>
      </div>
      <div class="metric-details">
        <h3>{{ movementsToday() }}</h3>
        <span>Movimientos Hoy</span>
      </div>
    </div>
  </div>
</div>

  <!-- Charts Section -->
  <div class="charts-grid">
    <!-- Stock Distribution Chart -->
    <orb-card class="chart-card">
      <div orbHeader>
        <h3><i class="fa fa-chart-pie"></i> Distribuci칩n del Stock</h3>
      </div>
      <div orbBody>
        <div class="chart-container">
          <p-chart
            type="doughnut"
            [data]="stockDistributionChartData()"
            [options]="chartOptions"
            height="300"
          >
          </p-chart>
        </div>

        <!-- Legend -->
        <div class="chart-legend" *ngIf="stockDistribution() as distribution">
          <div class="legend-item">
            <div class="legend-color bg-green-500"></div>
            <span>Stock Normal ({{ distribution.normal }})</span>
          </div>
          <div class="legend-item">
            <div class="legend-color bg-yellow-500"></div>
            <span>Stock Bajo ({{ distribution.low }})</span>
          </div>
          <div class="legend-item">
            <div class="legend-color bg-red-500"></div>
            <span>Sin Stock ({{ distribution.empty }})</span>
          </div>
          <div class="legend-item">
            <div class="legend-color bg-purple-500"></div>
            <span>Sobrestock ({{ distribution.over }})</span>
          </div>
        </div>
      </div>
    </orb-card>

    <!-- Movements Weekly Chart -->
    <orb-card class="chart-card">
      <div orbHeader>
        <h3><i class="fa fa-chart-line"></i> Movimientos Semanales</h3>
        <div class="chart-period">
          <orb-button label="7D" variant="text" size="small" class="active"> </orb-button>
          <orb-button label="30D" variant="text" size="small"> </orb-button>
        </div>
      </div>
      <div orbBody>
        <div class="chart-container">
          <p-chart
            type="line"
            [data]="movementsChartDataComputed()"
            [options]="lineChartOptions"
            height="300"
          >
          </p-chart>
        </div>
      </div>
    </orb-card>
  </div>

  <!-- Activity Section -->
  <div class="activity-grid">
    <!-- Low Stock Products -->
    <orb-card class="activity-card">
      <div orbHeader>
        <h3><i class="fa fa-exclamation-triangle text-orange-500"></i> Productos con Stock Bajo</h3>
        <orb-button label="Ver Todos" size="small" variant="text" (clicked)="navigateToProducts()">
        </orb-button>
      </div>
      <div orbBody>
        <div class="low-stock-list">
          <div class="stock-item" *ngFor="let item of lowStockProducts$ | async">
            <div class="item-info">
              <div class="item-name">{{ item.name }}</div>
              <div class="item-description">{{ item.description || 'Sin descripci칩n' }}</div>
            </div>
            <div class="item-stock">
              <p-tag [value]="item.currentStock + ' unidades'" [severity]="item.status"> </p-tag>
              <div class="stock-min">Min: {{ item.minStock }}</div>
            </div>
          </div>

          <!-- Mensaje cuando no hay productos con stock bajo -->
          <div class="no-movements" *ngIf="(lowStockProducts$ | async)?.length === 0">
            <i class="fa fa-check-circle"></i>
            <span>No hay productos con stock bajo</span>
          </div>
        </div>
      </div>
    </orb-card>

    <!-- Recent Movements -->
    <orb-card class="activity-card">
      <div orbHeader>
        <h3><i class="fa fa-history"></i> Movimientos Recientes</h3>
        <orb-button label="Ver Todos" size="small" variant="text" (clicked)="navigateToMovements()">
        </orb-button>
      </div>
      <div orbBody>
        <div class="movements-list">
          <div
            class="movement-item"
            *ngFor="let movement of recentMovements$ | async | slice : 0 : 5"
          >
            <div class="movement-icon" [class]="movement.typeClass">
              <i [class]="movement.typeIcon"></i>
            </div>
            <div class="movement-info">
              <div class="movement-product">{{ movement.productNameAtTime }}</div>
              <div class="movement-type">{{ movement.typeText }}</div>
              <div class="movement-date">{{ movement.formattedDate }}</div>
            </div>
            <div class="movement-quantity" [class]="getMovementQuantityClass(movement.quantity)">
              {{ movement.quantity > 0 ? '+' : '' }}{{ movement.quantity }}
            </div>
          </div>

          <!-- Mensaje cuando no hay movimientos -->
          <div class="no-movements" *ngIf="(recentMovements$ | async)?.length === 0">
            <i class="fa fa-info-circle"></i>
            <span>No hay movimientos recientes</span>
          </div>
        </div>
      </div>
    </orb-card>
  </div>

  <!-- Quick Actions Panel -->
  <orb-card class="quick-actions-panel">
    <div orbHeader>
      <h3><i class="fa fa-bolt"></i> Acciones R치pidas</h3>
    </div>
    <div orbBody>
      <div class="quick-actions-grid">
        <orb-button
          label="Registrar Entrada"
          icon="fa fa-plus-circle"
          size="large"
          severity="success"
          variant="outlined"
          (clicked)="navigateToMovements()"
        >
        </orb-button>
        <orb-button
          label="Registrar Salida"
          icon="fa fa-minus-circle"
          size="large"
          severity="danger"
          variant="outlined"
          (clicked)="navigateToMovements()"
        >
        </orb-button>
        <orb-button
          label="Ajuste de Stock"
          icon="fa fa-sliders-h"
          size="large"
          severity="info"
          variant="outlined"
          (clicked)="navigateToMovements()"
        >
        </orb-button>
        <orb-button
          label="Generar Reporte"
          icon="fa fa-file-pdf"
          size="large"
          severity="help"
          variant="outlined"
          (clicked)="navigateToReports()"
        >
        </orb-button>
      </div>
    </div>
  </orb-card>
