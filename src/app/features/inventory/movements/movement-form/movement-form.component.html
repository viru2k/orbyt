<form [formGroup]="form" (ngSubmit)="onSubmit()">
  
  <!-- Información del producto -->
  <div class="mb-4 p-3 bg-blue-50 border border-blue-200 border-radius">
    <div class="flex align-items-center gap-2">
      <i class="pi pi-info-circle text-blue-600"></i>
      <span class="font-semibold text-blue-800">Producto seleccionado:</span>
      <span class="text-blue-700">{{ productName }}</span>
      <span class="text-sm text-gray-500">(ID: {{ productId }})</span>
    </div>
  </div>

  <!-- Tipo de movimiento -->
  <orb-form-field>
    <label for="type">Tipo de Movimiento *</label>
    <p-dropdown
      id="type"
      formControlName="type"
      [options]="movementTypes"
      optionLabel="label"
      optionValue="value"
      placeholder="Selecciona el tipo de movimiento"
      styleClass="w-full"
    >
      <ng-template pTemplate="selectedItem" let-selectedType>
        <div class="flex align-items-center gap-2" *ngIf="selectedType">
          <i [class]="selectedType.icon" class="text-gray-600"></i>
          <span>{{ selectedType.label }}</span>
        </div>
      </ng-template>
      <ng-template pTemplate="item" let-typeOption>
        <div class="flex flex-column gap-1 p-2">
          <div class="flex align-items-center gap-2">
            <i [class]="typeOption.icon" class="text-gray-600"></i>
            <span class="font-semibold">{{ typeOption.label }}</span>
          </div>
          <small class="text-gray-500">{{ typeOption.description }}</small>
        </div>
      </ng-template>
    </p-dropdown>
    
    @if (getSelectedTypeDescription()) {
      <small class="text-gray-600 mt-1 block">{{ getSelectedTypeDescription() }}</small>
    }
    
    @if (form.get('type')?.invalid && (form.get('type')?.dirty || form.get('type')?.touched)) {
      <small class="text-red-500 mt-1 block">El tipo de movimiento es obligatorio</small>
    }
  </orb-form-field>

  <!-- Cantidad -->
  <orb-form-field>
    <label for="quantity">Cantidad *</label>
    <p-inputNumber
      id="quantity"
      formControlName="quantity"
      [min]="1"
      [step]="1"
      mode="decimal"
      [showButtons]="true"
      buttonLayout="horizontal"
      incrementButtonIcon="pi pi-plus"
      decrementButtonIcon="pi pi-minus"
      placeholder="Cantidad del movimiento"
      styleClass="w-full"
    />
    
    @if (form.get('quantity')?.invalid && (form.get('quantity')?.dirty || form.get('quantity')?.touched)) {
      <small class="text-red-500 mt-1 block">
        @if (form.get('quantity')?.errors?.['required']) {
          La cantidad es obligatoria
        }
        @if (form.get('quantity')?.errors?.['min']) {
          La cantidad debe ser mayor a 0
        }
      </small>
    }
  </orb-form-field>

  <!-- Razón/Comentario -->
  <orb-form-field>
    <label for="reason">Razón o Comentario</label>
    <textarea
      id="reason"
      formControlName="reason"
      pInputTextarea
      rows="3"
      placeholder="Opcional: especifica la razón del movimiento..."
      class="w-full"
    ></textarea>
    <small class="text-gray-600 mt-1 block">Campo opcional para agregar contexto al movimiento</small>
  </orb-form-field>

  <!-- Vista previa del efecto -->
  @if (form.get('type')?.value) {
    <div class="mt-4 p-3 border border-gray-200 border-radius">
      <div class="flex align-items-center gap-2 mb-2">
        <i class="pi pi-eye text-gray-600"></i>
        <span class="font-semibold">Vista previa del efecto:</span>
      </div>
      
      <div class="flex align-items-center gap-3">
        <span class="text-gray-600">Stock del producto:</span>
        
        @if (form.get('type')?.value === 'in') {
          <span class="text-green-600 font-semibold">
            <i class="pi pi-arrow-up mr-1"></i>
            Se incrementará en {{ form.get('quantity')?.value || 0 }} unidades
          </span>
        }
        
        @if (form.get('type')?.value === 'out' || form.get('type')?.value === 'usage') {
          <span class="text-red-600 font-semibold">
            <i class="pi pi-arrow-down mr-1"></i>
            Se reducirá en {{ form.get('quantity')?.value || 0 }} unidades
          </span>
        }
        
        @if (form.get('type')?.value === 'adjustment') {
          <span class="text-blue-600 font-semibold">
            <i class="pi pi-sliders-h mr-1"></i>
            Se ajustará según el valor especificado
          </span>
        }
      </div>
    </div>
  }

  <!-- Footer con botones -->
  <orb-form-footer
    [buttons]="footerActions"
    alignment="right"
    (actionClicked)="handleFooterAction($event)"
  />
  
</form>