<div class="profile-container">
  <div *ngIf="(loading$ | async) && !(user$ | async)" class="loading-state">
    <div class="loading-spinner">
      <i class="pi pi-spin pi-spinner"></i>
      <p>Cargando perfil...</p>
    </div>
  </div>

  <div *ngIf="user$ | async as user" class="profile-content">
    <!-- Header Section -->
    <div class="profile-header">
      <div class="header-background"></div>
      <div class="header-content">
        <div class="user-avatar-section">
          <div class="avatar-container">
            <div class="user-avatar">
              <span class="avatar-initials">{{ userInitials$ | async }}</span>
            </div>
            <div class="avatar-status" [class.active]="user.isActive">
              <i class="pi" [ngClass]="user.isActive ? 'pi-check' : 'pi-times'"></i>
            </div>
          </div>
          <div class="user-basic-info">
            <h1 class="user-name">{{ user.name }} {{ user.lastName }}</h1>
            <p class="user-email">{{ user.email }}</p>
            <div class="user-status">
              <span class="status-badge" [class.active]="user.isActive">
                <i class="pi" [ngClass]="user.isActive ? 'pi-check-circle' : 'pi-times-circle'"></i>
                {{ user.isActive ? 'Activo' : 'Inactivo' }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="profile-main">
      <div class="content-grid">
        <!-- Profile Information Card -->
        <div class="info-card">
          <div class="card-header">
            <h3 class="card-title">
              <i class="pi pi-user"></i>
              Información Personal
            </h3>
            <button class="edit-toggle-btn" (click)="toggleEditMode()">
              <i class="pi" [ngClass]="isEditMode ? 'pi-times' : 'pi-pencil'"></i>
              {{ isEditMode ? 'Cancelar' : 'Editar' }}
            </button>
          </div>
          
          <div class="card-content">
            <div class="info-section" *ngIf="!isEditMode">
              <div class="info-item">
                <label>Nombre completo</label>
                <span>{{ user.name }} {{ user.lastName }}</span>
              </div>
              <div class="info-item">
                <label>Correo electrónico</label>
                <span>{{ user.email }}</span>
              </div>
            </div>
            
            <form *ngIf="isEditMode" [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="edit-form">
              <div class="form-row">
                <orb-form-field label="Nombre">
                  <orb-text-input formControlName="name" placeholder="Ingresa tu nombre"></orb-text-input>
                </orb-form-field>
                <orb-form-field label="Apellidos">
                  <orb-text-input formControlName="lastName" placeholder="Ingresa tus apellidos"></orb-text-input>
                </orb-form-field>
              </div>
              <orb-form-field label="Email">
                <orb-text-input formControlName="email" type="email"  placeholder="Tu correo electrónico"></orb-text-input>
              </orb-form-field>
              
              <orb-form-footer 
                [buttons]="formButtons"
                alignment="right"
                (actionClicked)="handleFormAction($event)"
              ></orb-form-footer>
            </form>
          </div>
        </div>

        <!-- Roles and Permissions Card -->
        <div class="roles-card">
          <div class="card-header">
            <h3 class="card-title">
              <i class="pi pi-shield"></i>
              Roles y Permisos
            </h3>
          </div>
          
          <div class="card-content">
            <!-- Roles Section -->
            <div class="roles-section">
              <h4>Roles asignados</h4>
              <div class="roles-list">
                <div *ngFor="let role of user.roles" class="role-badge">
                  <i class="pi pi-shield"></i>
                  <span>{{ role.name }}</span>
                </div>
              </div>
            </div>
            
            <!-- Permissions Section -->
            <div class="permissions-section">
              <h4>Permisos otorgados</h4>
              <div class="permissions-grid">
                <div class="permission-item" [class.granted]="user.canManageAgenda">
                  <div class="permission-icon">
                    <i class="pi pi-calendar"></i>
                  </div>
                  <div class="permission-info">
                    <span class="permission-name">Gestionar Agenda</span>
                    <span class="permission-status">
                      <i class="pi" [ngClass]="user.canManageAgenda ? 'pi-check' : 'pi-times'"></i>
                      {{ user.canManageAgenda ? 'Permitido' : 'Denegado' }}
                    </span>
                  </div>
                </div>
                
                <div class="permission-item" [class.granted]="user.canManageClients">
                  <div class="permission-icon">
                    <i class="pi pi-users"></i>
                  </div>
                  <div class="permission-info">
                    <span class="permission-name">Gestionar Clientes</span>
                    <span class="permission-status">
                      <i class="pi" [ngClass]="user.canManageClients ? 'pi-check' : 'pi-times'"></i>
                      {{ user.canManageClients ? 'Permitido' : 'Denegado' }}
                    </span>
                  </div>
                </div>
                
                <div class="permission-item" [class.granted]="user.canManageProducts">
                  <div class="permission-icon">
                    <i class="pi pi-box"></i>
                  </div>
                  <div class="permission-info">
                    <span class="permission-name">Gestionar Productos</span>
                    <span class="permission-status">
                      <i class="pi" [ngClass]="user.canManageProducts ? 'pi-check' : 'pi-times'"></i>
                      {{ user.canManageProducts ? 'Permitido' : 'Denegado' }}
                    </span>
                  </div>
                </div>
                
                <div class="permission-item" [class.granted]="user.canManageUsers">
                  <div class="permission-icon">
                    <i class="pi pi-user-cog"></i>
                  </div>
                  <div class="permission-info">
                    <span class="permission-name">Gestionar Usuarios</span>
                    <span class="permission-status">
                      <i class="pi" [ngClass]="user.canManageUsers ? 'pi-check' : 'pi-times'"></i>
                      {{ user.canManageUsers ? 'Permitido' : 'Denegado' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
